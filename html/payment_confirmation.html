<!DOCTYPE html>
<html>

<head>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="../css/nouislider.css" />
    <link rel="stylesheet" href="../css/checkout.css" />
</head>

<body>
    <product-edit-component style="display:block;0:display;display:block;" _nghost-c21="" class="ng-tns-c21-28 ng-trigger ng-trigger-fadeInAnimation ng-star-inserted">
        <notice-bar-component _ngcontent-c21="" class="c-product-edit__notice-bar ng-tns-c7-29" _nghost-c7="">
            <!---->
        </notice-bar-component>
        <div _ngcontent-c21="" class="c-product-edit">
            <!---->
            <error-bar-component _ngcontent-c21="" class="c-error-bar c-product-edit__error-bar ng-tns-c8-30" _nghost-c8="">
                <!---->
            </error-bar-component>
            <!---->
            <div _ngcontent-c21="" class="c-product-edit__header ng-tns-c21-28 ng-star-inserted" style="">
                <button _ngcontent-c21="" class="c-product-edit__header__back-link c-btn c-btn--bare c-text-m">
                    <svg _ngcontent-c21="" class="c-icon c-product-edit__header__back-link__icon">
                        <use _ngcontent-c21="" class="ng-tns-c21-28" xlink:href="#chevron"></use>
                    </svg><span _ngcontent-c21="" class="c-product-edit__header__back-link__text">BACK</span></button>
                <div _ngcontent-c21="" class="ng-tns-c21-28">
                    <!---->
                    <!---->
                </div>
            </div>
            <product-options-component _ngcontent-c21="" class="c-product-edit__options ng-tns-c22-31 ng-tns-c21-28 ng-star-inserted" style="">
                <div class="c-product-options">
                    <div class="c-product-options__tabs">
                        <div class="c-product-options__tab c-product-options__tab--selected" title="Design &amp; Edit">
                            <svg class="c-icon u-center-in-parent c-product-options__tab__icon">
                                <use class="ng-tns-c22-31" xlink:href="#pencil"></use>
                            </svg>
                            <!---->
                        </div>
                        <div class="c-product-options__tab" title="Configure">
                            <svg class="c-icon u-center-in-parent c-product-options__tab__icon">
                                <use class="ng-tns-c22-31" xlink:href="#tune-icon"></use>
                            </svg>
                            <!---->
                        </div>
                        <div class="c-product-options__tab" title="Information">
                            <svg class="c-icon u-center-in-parent c-product-options__tab__icon">
                                <use class="ng-tns-c22-31" xlink:href="#info-form"></use>
                            </svg>
                            <!---->
                        </div>
                    </div>
                    <div class="c-product-options__content">
                        <!---->
                        <product-options-edit-component class="c-product-options__sub-component ng-tns-c22-31 ng-trigger ng-trigger-fadeInAnimation ng-star-inserted" _nghost-c24="" style="">
                            <h2 _ngcontent-c24="" class="c-title-m c-product-options__title">Checkout</h2>

                            <side-selector-full-info-component _ngcontent-c24="">
                                <fulfilment-field-control-list-component _nghost-c33="">
                                    <div _ngcontent-c33="" class="c-fulfilment-field-control-list-component">
                                        <!-- <div _ngcontent-c33="" class="c-text-s c-fulfilment-field-control-list-component__title">SELECT SIDE</div>
                                         -->
                                        <fulfilment-field-control-component _ngcontent-c33="" _nghost-c34="" class="ng-star-inserted" style="">
                                            <div _ngcontent-c34="" class="c-fulfilment-field-control-componen flex-column">
                                                <img id="tiny-image" />
                                            </div>

                                        </fulfilment-field-control-component>

                                    </div>
                                </fulfilment-field-control-list-component>
                            </side-selector-full-info-component>
                            <!---->
                        </product-options-edit-component>
                        <!---->
                        <!---->
                    </div>
                    <!---->
                </div>
            </product-options-component>
            <div _ngcontent-c21="" class="c-product-edit__options__main ng-tns-c21-28 ng-star-inserted" style="">
                <!---->
                <div _ngcontent-c21="" class="c-product-edit__image-editor-wrapper">

                    <image-editor-display-component _ngcontent-c21="" class="c-product-edit__image-editor ng-tns-c23-32 ng-tns-c21-28 ng-star-inserted" _nghost-c23="">
                        <div _ngcontent-c23="" class="c-image-editor-display">
                            <fulfilment-field-control-component _ngcontent-c33="" _nghost-c34="" class="ng-star-inserted" style="">
                                <div _ngcontent-c34="" class="c-fulfilment-field-control-component flex-column">
                                    <h1>Thank you for your order!</h1>
                                    <div _ngcontent-c34="" class="c-fulfilment-field-control-component__field-info c-fulfilment-field-control-component__field-info--not-current ng-star-inserted "><span _ngcontent-c34="" class="c-text-m">You'll receive an email with the confirmation and tracking information</span></div>
                                

                                </div>
                            </fulfilment-field-control-component>
                        </div>
                    </image-editor-display-component>
                </div>
            </div>
        </div>
    </product-edit-component>

    <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
    <script src="../js/lib/crs.min.js"></script>
    <script src="../js/bundle.js"></script>
    <!-- <script src="https://www.paypal.com/sdk/js?client-id=sb"></script>
    <script>paypal.Buttons().render('body');</script> -->
    <script>
        // edit();

        function create_link(url) {
            /* create the link element */
            var linkElement = document.createElement('link');

            /* add attributes */
            linkElement.setAttribute('rel', 'stylesheet');
            linkElement.setAttribute('href', url);

            /* attach to the document head */
            document.getElementsByTagName('head')[0].appendChild(linkElement);
        }

        function create_script(url) {
            /* create the link element */
            var linkElement = document.createElement('script');

            /* add attributes */
            linkElement.setAttribute('src', url);

            /* attach to the document body */
            document.getElementsByTagName('body')[0].appendChild(linkElement);
        }

        create_link('../css/editor.css')
        create_link('../css/kitely.css')

        function loadData() {
            return new Promise((resolve, reject) => {
                const pricesRaw = localStorage.getItem('prices');
                const addressRaw = localStorage.getItem('address');

                if (!pricesRaw || !addressRaw) {
                    reject('no data');
                    return;
                }
                const pricesJSON = JSON.parse(pricesRaw);
                const addressJSON = JSON.parse(addressRaw);

                Address.build(addressJSON).then((address) => {
                    resolve({
                        prices: pricesJSON,
                        address: addressJSON
                    })
                }).catch((err) => {
                    reject(err);
                });
            });
        }

        function processPaypalPayment(callback) {
            setTimeout(() => {
                paypal.Buttons({
                    createOrder: function(data, actions) {
                        // Set up the transaction
                        return actions.order.create({
                            purchase_units: [{
                                amount: {
                                    currency_code: currency,
                                    value: '1', // prices.total_product_cost[currency]
                                }
                            }]
                        });
                    },
                    onApprove: function(data, actions) {
                        return actions.order.capture().then(function(details) {
                            // alert('Transaction completed by ' + details.payer.name.given_name);
                            // window.deets = details;
                            callback(details);
                            // Call your server to save the transaction
                            // return fetch('/paypal-transaction-complete', {
                            //     method: 'post',
                            //     headers: {
                            //         'content-type': 'application/json'
                            //     },
                            //     body: JSON.stringify({
                            //         orderID: data.orderID
                            //     })
                            // });
                        });
                    }
                }).render('#paypal-button-container');
                if (env === 'test') {
                    return callback(sampleTransaction);
                }
            }, 500);
        }

        $(document).ready(function() {
            const currency = 'USD' // 'GBP';
            const currencySymbol = '$'; // '&pound;';
            const modifiedImageUrl = localStorage.getItem('modifiedImageUrl');
            if (modifiedImageUrl) {
                $("#tiny-image").attr('src', modifiedImageUrl);
                $("#tiny-image").css('width', '150%');
                $("#tiny-image").css('margin-top', '20px');
            }

            loadData().then(({
                prices, address
            }) => {
                console.log(prices);
                console.log(address);
                $("#product-cost").html(`${currencySymbol} ${prices.total_product_cost[currency]}`);
                $("#shipping-cost").html(`${currencySymbol} ${prices.total_shipping_cost[currency]}`);
                $("#total-cost").html(`${currencySymbol} ${prices.total_product_cost[currency]}`);

            }).catch((err) => {
                console.error(err);
            });
        });
    </script>

</body>

</html>